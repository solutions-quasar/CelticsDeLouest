rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }

    // PRODUCTS (Boutique)
    match /products/{productId} {
      allow read: if true;
      allow write: if isAuthenticated();
    }

    // BOARD MEMBERS (Conseil d'administration)
    match /board_members/{memberId} {
      allow read: if true;
      allow write: if isAuthenticated();
    }

    // REFEREES (Arbitres)
    match /referees/{refereeId} {
      allow read: if true;
      allow write: if isAuthenticated();
    }

    // REGISTRATIONS (Inscriptions)
    // Public can create (submit form), but only Admins can read (view list)
    match /registrations/{regId} {
      allow create: if true;
      allow read, update, delete: if isAuthenticated();
    }

    // PLAYERS (Team Generator)
    match /players/{playerId} {
      allow read, write: if isAuthenticated();
    }

    // INVENTORY
    match /inventory/{itemId} {
      allow read, write: if isAuthenticated();
    }

    // ADMINS
    match /admins/{adminId} {
      allow read, write: if isAuthenticated();
    }

    // COACHES
    match /coaches/{coachId} {
      allow read: if true;
      allow write: if isAuthenticated();
    }
    
    // SETTINGS (Global Config)
    match /settings/{docId} {
      allow read: if true;
      allow write: if isAuthenticated();
    }

    
    // MATCHES
    match /matches/{matchId} {
        allow read: if true;
        allow write: if isAuthenticated();
    }

    // SPONSORS
    match /sponsors/{sponsorId} {
      allow read: if true;
      allow write: if isAuthenticated();
    }

    // TEAMS
    match /teams/{teamId} {
      allow read, write: if isAuthenticated();
    }

    // SEASONS
    match /seasons/{seasonId} {
      allow read: if true;
      allow write: if isAuthenticated();
    }
    
    // Default fallback: Deny everything else
    match /{document=**} {
      allow read, write: if false;
    }
  }
}